<% const sOrH = template.firmware >= 2.03 ? 'H' : 'S'; -%>
; homex.g
; called to home the X axis
;
; generated by RepRapFirmware Configuration Tool v<%- version %> on <%- (new Date()).toString() %>
G91 ; relative positioning
G1 <%- sOrH %>2 Z<%- template.z_dive_height %> F<%- template.travel_speed * 60 %> ; lift Z relative to current position
<%	if (template.drives[0].endstop_type == 3) {
		if (template.probe.deploy && template.firmware < 1.21) { -%>
M98 P"deployprobe.g" ; deploy mechanical Z probe
<%		}
	}

	let travelTo = Math.abs(template.geometry.mins[0]) + Math.abs(template.geometry.maxes[0]) + 5;
	let travelBack = -5;
	if (template.drives[0].endstop_location == 1) {
		travelTo *= -1;
		travelBack *= -1;
	} -%>
G1 <%- sOrH %>1 X<%- travelTo %> F<%- template.homing_speed_fast * 60 %> ; move quickly to X axis endstop and stop there (first pass)
<%	if (template.geometry.type.startsWith('core')) { -%>
G1 X<%- travelBack %> F<%- template.travel_speed * 60 %> ; go back a few mm
<%	} else { -%>
G1 <%- sOrH %>2 X<%- travelBack %> F<%- template.travel_speed * 60 %> ; go back a few mm
<% } -%>
G1 <%- sOrH %>1 X<%- travelTo %> F<%- template.homing_speed_slow * 60 %> ; move slowly to X axis endstop once more (second pass)
<%	if (template.drives[0].endstop_type == 3) {
		if (template.probe.deploy && template.firmware < 1.21) { -%>
M98 P"retractprobe.g" ; retract the mechanical Z probe
<%		}
	} -%>
G1 <%- sOrH %>2 Z<%- -template.z_dive_height %> F<%- template.travel_speed * 60 %> ; lower Z again
G90 ; absolute positioning
