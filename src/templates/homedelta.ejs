; homedelta.g
; called to home all towers on a delta printer
;
; generated by RepRapFirmware Configuration Tool v<%- version %> on <%- (new Date()).toString() %>
G91 ; relative positioning
<%	const endstopsAtMin = (template.drives[0].endstop_location === 0), sOrH = template.firmware >= 2.03 ? 'H' : 'S';;
	let deployProbe = false;
	for (let i = 0; i < 3; i++) {
		if (template.drives[i].endstop_type === 3) {
			deployProbe = template.probe.deploy;
			break;
		}
	}
	if (deployProbe && template.firmware < 1.21) { -%>
M98 P"deployprobe.g" ; deploy mechanical Z probe
<%	}
	const lowOrHigh = endstopsAtMin ? 'low' : 'high';
	const travelTo = endstopsAtMin ? -(template.geometry.max_carriage_travel + 5) : template.geometry.max_carriage_travel + 5;
	const fastHomingSpeed = template.slow_homing ? template.homing_speed_fast * 0.1 : template.homing_speed_fast;
	const slowHomingSpeed = template.slow_homing ? Math.min(fastHomingSpeed, template.homing_speed_slow) : template.homing_speed_slow;

	if (template.slow_homing) { -%>
;*** Slow homing has been configured. Change F<%- fastHomingSpeed * 60 %> to F<%- template.homing_speed_fast * 60 %> below when your configuration is working
<%	} -%>
G1 <%- sOrH %>1 X<%- travelTo %> Y<%- travelTo %> Z<%- travelTo %> F<%- fastHomingSpeed * 60 %> ; move all towers to the <%- lowOrHigh %> end stopping at the endstops (first pass)
G1 <%- sOrH %>2 X<%- endstopsAtMin ? 5 : -5 %> Y<%- endstopsAtMin ? 5 : -5 %> Z<%- endstopsAtMin ? 5 : -5 %> F<%- template.homing_speed_fast * 60 %> ; go <%- endstopsAtMin ? 'up' : 'down' %> a few mm
<%	if (template.slow_homing && slowHomingSpeed != template.homing_speed_slow) { -%>
;*** Slow homing has been configured. Change F<%- slowHomingSpeed * 60 %> to F<%- template.homing_speed_slow * 60 %> below when your configuration is working
<%	} -%>
G1 <%- sOrH %>1 X<%- endstopsAtMin ? -10 : 10 %> Y<%- endstopsAtMin ? -10 : 10 %> Z<%- endstopsAtMin ? -10 : 10 %> F<%- slowHomingSpeed * 60 %> ; move all towers <%- endstopsAtMin ? 'down' : 'up' %> once more (second pass)
G1 Z<%- endstopsAtMin ? 5 : -5 %> F<%- template.travel_speed * 60 %> ; move <%- endstopsAtMin ? 'up' : 'down' %> a few mm so that the nozzle can be centred
G90 ; absolute positioning
G1 X0 Y0 F<%- template.travel_speed * 60 %> ; move X+Y to the centre
<%	if (deployProbe && template.firmware < 1.21) { -%>
M98 P"retractprobe.g" ; retract mechanical Z probe
<%	} -%>
