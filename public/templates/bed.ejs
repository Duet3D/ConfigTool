<%  if (!preview) { -%>
; <%- filename %>
; called to <%- model.isDelta ? 'perform automatic delta calibration' : 'level the bed' %>
;
; generated by RepRapFirmware Configuration Tool v<%- version %> on <%- (new Date()).toString() %>

<%	}

    if (model.isDelta) {
        if (model.configTool.delta.homeFirst) { -%>
G28 ; home the towers first
<%      } -%>
; Probe the bed at <%- model.configTool.delta.peripheralPoints %> peripheral and <%- model.configTool.delta.halfwayPoints %> halfway points, and perform <%- model.configTool.delta.factors %>-factor auto compensation
; Before running this, you should have set up your Z-probe trigger height to suit your build, in the G31 command in config.g.
<%		for (let i = 0; i < model.configTool.delta.probePoints.length; i++) {
            const point = model.configTool.delta.probePoints[i]; -%>
G30 <%- params({
    P: i,
    X: point.x,
    Y: point.y,
    H: point.heightCorrection,
    Z: -99999,
    S: (i === model.configTool.delta.probePoints.length - 1) ? model.configTool.delta.factors : undefined
}) %>
<%		} -%>
; Use S-1 for measurements only, without calculations. Use S4 for endstop heights and Z-height only. Use S6 for full 6 factors
; If your Z probe has significantly different trigger heights depending on XY position, adjust the H parameters in the G30 commands accordingly. The value of each H parameter should be (trigger height at that XY position) - (trigger height at centre of bed)
<%  } else { -%>
G29 ; call mesh bed compensation
<%  } -%>