<% const sOrH = template.firmware >= 2.03 ? 'H' : 'S'; -%>
; homez.g
; called to home the Z axis
;
; generated by RepRapFirmware Configuration Tool v<%- version %> on <%- (new Date()).toString() %>
G91 ; relative positioning
G1 <%- sOrH %>2 Z<%- template.z_dive_height %> F<%- template.travel_speed * 60 %> ; lift Z relative to current position
<%	if (template.drives[2].endstop_type != 3) {
		let travelToZ = Math.abs(template.geometry.mins[2]) + Math.abs(template.geometry.maxes[2]) + 5;
		let travelZDirection = 'up';
		if (template.drives[2].endstop_location == 1) {
			travelZDirection = 'down';
			travelToZ *= -1;
		} -%>
G1 <%- sOrH %>1 Z<%- travelToZ %> F<%- template.homing_speed_fast * 60 %> ; move Z <%- travelZDirection %> until the endstop is triggered
G92 Z<%- (template.drives[2].endstop_location === 1) ? template.geometry.mins[2] : template.geometry.maxes[2] %> ; set Z position to axis <%- (template.drives[2].endstop_location === 1) ? 'minimum' : 'maximum' %> (you may want to adjust this)
<%	} else { -%>
G90 ; absolute positioning
G1 X<%- util.getFirstProbePoint(0) - template.probe.x_offset %> Y<%- util.getFirstProbePoint(1) - template.probe.y_offset %> F<%- template.travel_speed * 60 %> ; go to first probe point
G30 ; home Z by probing the bed
<%	} -%>

; Uncomment the following lines to lift Z after probing
;G91 ; relative positioning
;G1 Z<%- template.z_dive_height %> F<%- template.travel_speed %> ; lift Z relative to current position
;G90 ; absolute positioning
